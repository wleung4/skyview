!function(){"use strict";!function(){const t=[];let e;const n=async()=>{const n=await fetch("https://wleung4.github.io/skyview/iata-icao.csv");(await n.text()).split("\n").slice(1).forEach((e=>{const n=e.split(","),a=n[0].slice(1,n[0].length-1),o=n[1].slice(1,n[1].length-1),l=n[2].slice(1,n[2].length-1),s=n[3].slice(1,n[3].length-1),r=n[4].slice(1,n[4].length-1),c=n[5].slice(1,n[5].length-1),i=n[6].slice(1,n[6].length-2);t.push({airport:r,country_code:a,region_name:o,iata:l,icao:s,latitude:c,longitude:i})})),e=t.reduce(((t,e)=>Object.assign(t,{[e.airport]:e},{})))},a=async t=>{await n();for(const n in e)if(n.toLowerCase()===t.toLowerCase())return[n,e[n].icao,e[n].latitude,e[n].longitude]};let o;const l=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const n=await fetch(`https://opensky-network.org/api/tracks/all?icao24=${t}&time=${e}`,{headers:{Accept:"application/json"}});if(n.ok)return(await n.json()).path;throw new Error("response not ok")}catch(t){console.error("Error fetching data",t)}},s=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.floor(new Date/1e3)-3600*t};let r,c,i;const d=async(t,e)=>{const n=[];n.push(i);const a=await t;a.forEach((t=>{n.push(c([t[2],t[1]]))}));const o=d3.line().x((t=>t[0])).y((t=>t[1]));r.append("path").data([n]).attr("fill","none").style("stroke","#9c180c").style("stroke-width",.1).attr("d",o);const l=n[n.length-1],s=a[a.length-1][4];r.append("image").attr("xlink:href","https://wleung4.github.io/skyview/assets/plane.png").attr("width",1.5).attr("height",1.5).attr("x",l[0]-.75).attr("y",l[1]-.75).attr("transform",`rotate(${s}, ${l[0]}, ${l[1]})`),r.append("text").attr("x",l[0]+.75).attr("y",l[1]+.75).text(e).style("font-size",".75px").style("stroke","purple")},p=document.querySelector(".home-search"),u=document.querySelector("#search"),h=document.querySelector("#search-results"),y=document.querySelector("#flight-table"),m=document.querySelector(".main-page"),f=document.querySelector("#background"),g=document.querySelector(".instructions"),w=document.querySelector(".reset"),C=document.querySelector("#map");let x,k,E,v=null;u.addEventListener("keyup",(()=>{h.style.display="none",g.style.display="block",clearTimeout(v),v=setTimeout((async()=>{if(""!==u.value){g.style.display="none";const t=await(async t=>{await n();const a=[];return Object.keys(e).slice(7).forEach((e=>{e.toLowerCase().includes(t.toLowerCase())&&a.push(e)})),0===a.length&&a.push("No Results Found"),a})(u.value);j(t)}}),500)})),w.addEventListener("click",(t=>{t.preventDefault(),m.style.display="none",C.style.display="none",p.style.display="flex",f.style.display="inline",u.value="",h.style.display="none",g.style.display="block",w.style.display="none",y.removeChild(y.firstChild),d3.select("#map").select("svg").remove()})),p.addEventListener("submit",(async t=>{t.preventDefault();let e=u.value;""===e&&(e="N/A");let n=await a(e);for(;!n;)n=await a(e);E=n[0];const l=n[1],d=n[2],h=n[3];p.style.display="none",m.style.display="flex",f.style.display="none",w.style.display="block",C.style.display="block",x=await(async(t,e,n)=>{try{const a=await fetch(`https://opensky-network.org/api/flights/departure?airport=${t}&begin=${e}&end=${n}`,{headers:{Accept:"application/json"}});if(a.ok){const t=await a.json();return o=t,t}throw new Error("response not ok")}catch(t){console.error("Error fetching departures",t)}})(l,s(6),s()),b(x),((t,e)=>{const n=d3.select("#map").append("svg").attr("width",800).attr("height",600);r=n.append("g");let a=d3.zoom().scaleExtent([1,80]).translateExtent([[0,0],[800,600]]).on("zoom",(t=>{r.attr("transform",t.transform)}));n.call(a),c=d3.geoMercator().center([t[0],t[1]]).translate([400,300]).scale(120),a.scaleTo(n,20);const o=d3.geoPath().projection(c);d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then((n=>{const a=topojson.feature(n,n.objects.countries),l=c(t);i=l,r.selectAll("path").data(a.features).enter().append("path").attr("d",o),r.selectAll("circle").data(t).enter().append("circle").attr("cx",l[0]).attr("cy",l[1]).attr("r",.25).style("fill","yellow"),r.selectAll("text").data(t).enter().append("text").attr("x",l[0]+.5).attr("y",l[1]).text(e).style("font-size","1px").style("stroke","blue")}))})([h,d],l)}));const b=async t=>{let e=document.createElement("table"),n=document.createElement("tbody");const a=document.createElement("tr");a.classList.add("header");const o=document.createElement("td");o.textContent="Plane";const s=document.createElement("td");s.textContent="Time Departed";const r=document.createElement("td");r.textContent="From";const c=document.createElement("td");c.textContent="To",a.appendChild(o),a.appendChild(s),a.appendChild(r),a.appendChild(c),n.appendChild(a);for(let e=0;e<t.length;e++){const a=document.createElement("tr"),o=document.createElement("td");o.textContent=t[e].callsign,o.classList.add("clickable"),o.addEventListener("click",(async n=>{n.stopPropagation(),k=l(t[e].icao24),"No data found"!==k&&d(k,o.textContent)}));const s=document.createElement("td"),r=new Date(1e3*t[e].firstSeen).toString();s.textContent=r.slice(0,28);const c=document.createElement("td");c.textContent=t[e].estDepartureAirport;let i=document.createElement("td");null===t[e].estArrivalAirport?i.textContent="TBD":i.textContent=t[e].estArrivalAirport,a.appendChild(o),a.appendChild(s),a.appendChild(c),a.appendChild(i),n.appendChild(a)}e.appendChild(n),y.appendChild(e),y.classList.add("table-style")},j=t=>{for(;h.firstChild;)h.removeChild(h.firstChild);t.forEach((t=>{const e=document.createElement("div");e.textContent=t,e.addEventListener("click",(t=>{t.stopPropagation(),u.value=e.textContent})),h.appendChild(e)})),h.style.display="block"}}()}();
//# sourceMappingURL=main.js.map