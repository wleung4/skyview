!function(){"use strict";!function(){const t=[];let e;const n=async()=>{const n=await fetch("./iata-icao.csv");(await n.text()).split("\n").slice(1).forEach((e=>{const n=e.split(","),a=n[0].slice(1,n[0].length-1),l=n[1].slice(1,n[1].length-1),o=n[2].slice(1,n[2].length-1),r=n[3].slice(1,n[3].length-1),s=n[4].slice(1,n[4].length-1),c=n[5].slice(1,n[5].length-1),i=n[6].slice(1,n[6].length-2);t.push({airport:s,country_code:a,region_name:l,iata:o,icao:r,latitude:c,longitude:i})})),e=t.reduce(((t,e)=>Object.assign(t,{[e.airport]:e},{})))},a=async t=>{await n();for(const n in e)if(n.toLowerCase()===t.toLowerCase())return[n,e[n].icao,e[n].latitude,e[n].longitude]};let l,o;const r="https://opensky-network.org/api/flights/",s=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const n=await fetch(`https://opensky-network.org/api/tracks/all?icao24=${t}&time=${e}`,{headers:{Accept:"application/json"}});if(n.ok)return(await n.json()).path;throw new Error("response not ok")}catch(t){console.error("Error fetching data",t)}},c=async(t,e,n)=>{try{const a=await fetch(r+`aircraft?icao24=${t}&begin=${e}&end=${n}`,{headers:{Accept:"application/json"}});if(a.ok){const t=await a.json();return o=t,t}throw new Error("response not ok")}catch(t){console.error("Error fetching aircraft",t)}},i=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.floor(new Date/1e3)-3600*t};let d,p,h;const u=async(t,e)=>{const n=[];n.push(h);const a=await t;a.forEach((t=>{n.push(p([t[2],t[1]]))}));const l=d3.line().x((t=>t[0])).y((t=>t[1]));d.append("path").data([n]).attr("fill","none").style("stroke","#9c180c").style("stroke-width",.1).attr("d",l).attr("class","flight-path");const o=n[n.length-1],r=a[a.length-1][4];d.append("image").attr("xlink:href","./assets/plane.png").attr("width",1.5).attr("height",1.5).attr("x",o[0]-.75).attr("y",o[1]-.75).attr("transform",`rotate(${r}, ${o[0]}, ${o[1]})`).attr("class","flight-image"),d.append("text").attr("x",o[0]+.75).attr("y",o[1]+.75).text(e).style("font-size",".75px").style("stroke","purple").attr("class","flight-text")},m=document.querySelector(".home-search"),y=document.querySelector("#search"),C=document.querySelector("#search-results"),f=document.querySelector("#flight-table"),g=document.querySelector(".main-page"),x=document.querySelector("#background"),E=document.querySelector(".instructions"),w=document.querySelector(".reset"),v=document.querySelector("#map"),k=document.querySelector(".reset-paths"),b=document.querySelector("#flight-history"),A=document.querySelector(".map-and-flight-table");let S,L,j,D=null,q=!1;y.addEventListener("keyup",(()=>{clearTimeout(D),q||(D=setTimeout((async()=>{if(""!==y.value){const t=await(async t=>{await n();const a=[];return Object.keys(e).slice(7).forEach((e=>{e.toLowerCase().includes(t.toLowerCase())&&a.push(e)})),0===a.length&&a.push("No Results Found"),a})(y.value);E.style.display="none",T(t)}else C.style.display="none",E.style.display="block"}),500)),q=!1})),w.addEventListener("click",(t=>{t.preventDefault(),g.style.display="none",v.style.display="none",m.style.display="flex",x.style.display="inline",y.value="",C.style.display="none",E.style.display="block",w.style.display="none",k.style.display="none",b.style.display="none",d3.select("#map").select("svg").remove(),f.removeChild(f.firstChild),b.removeChild(b.firstChild),A.style.display="none"})),m.addEventListener("submit",(async t=>{t.preventDefault();let e=y.value;""===e&&(e="N/A");let n=await a(e);for(;!n;)n=await a(e);j=n[0];const o=n[1],s=n[2],c=n[3];m.style.display="none",g.style.display="flex",x.style.display="none",w.style.display="block",A.style.display="flex",v.style.display="block",S=await(async(t,e,n)=>{try{const a=await fetch(r+`departure?airport=${t}&begin=${e}&end=${n}`,{headers:{Accept:"application/json"}});if(a.ok){const t=await a.json();return l=t,t}throw new Error("response not ok")}catch(t){console.error("Error fetching departures",t)}})(o,i(6),i()),await $(S),await((t,e)=>{const n=d3.select("#map").append("svg").attr("width",800).attr("height",600);d=n.append("g");let a=d3.zoom().scaleExtent([1,80]).translateExtent([[0,0],[800,600]]).on("zoom",(t=>{d.attr("transform",t.transform)}));n.call(a),p=d3.geoMercator().center([t[0],t[1]]).translate([400,300]).scale(120),a.scaleTo(n,20);const l=d3.geoPath().projection(p);d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then((n=>{const a=topojson.feature(n,n.objects.countries),o=p(t);h=o,d.selectAll("path").data(a.features).enter().append("path").attr("d",l),d.selectAll("circle").data(t).enter().append("circle").attr("cx",o[0]).attr("cy",o[1]).attr("r",.25).style("fill","yellow"),d.selectAll("text").data(t).enter().append("text").attr("x",o[0]+.5).attr("y",o[1]).text(e).style("font-size","1px").style("stroke","blue")}))})([c,s],o)}));const $=async t=>{let e=document.createElement("table"),n=document.createElement("tbody");const a=document.createElement("tr");a.classList.add("header");const l=document.createElement("td");l.textContent="Flight";const o=document.createElement("td");o.textContent="Time Departed";const r=document.createElement("td");r.textContent="From";const d=document.createElement("td");d.textContent="To",a.appendChild(l),a.appendChild(o),a.appendChild(r),a.appendChild(d),n.appendChild(a);for(let e=0;e<t.length;e++){const a=document.createElement("tr"),l=document.createElement("td");l.textContent=t[e].callsign,l.classList.add("clickable"),l.addEventListener("click",(async n=>{if(n.stopPropagation(),L=s(t[e].icao24),"No data found"!==L){u(L,l.textContent);const n=await c(t[e].icao24,i(336),i());b.style.display="none",b.removeChild(b.firstChild),F(n),b.style.display="block"}}));const o=document.createElement("td"),r=new Date(1e3*t[e].firstSeen).toString();o.textContent=r;const d=document.createElement("td");d.textContent=t[e].estDepartureAirport;let p=document.createElement("td");null===t[e].estArrivalAirport?p.textContent="TBD":p.textContent=t[e].estArrivalAirport,a.appendChild(l),a.appendChild(o),a.appendChild(d),a.appendChild(p),n.appendChild(a)}e.appendChild(n),f.appendChild(e),f.classList.add("table-style")},T=t=>{for(;C.firstChild;)C.removeChild(C.firstChild);t.forEach((t=>{const e=document.createElement("div");e.textContent=t,e.addEventListener("click",(t=>{t.stopPropagation(),y.value=e.textContent,C.style.display="none",q=!0,E.style.display="block"})),C.appendChild(e)})),q||(C.style.display="block")};k.addEventListener("click",(()=>{d.selectAll(".flight-path").remove(),d.selectAll(".flight-image").remove(),d.selectAll(".flight-text").remove()}));const F=t=>{let e=document.createElement("table"),n=document.createElement("tbody");const a=document.createElement("tr");a.classList.add("header");const l=document.createElement("td");l.textContent="Flight";const o=document.createElement("td");o.textContent="Time Departed";const r=document.createElement("td");r.textContent="Time Arrived";const s=document.createElement("td");s.textContent="From";const c=document.createElement("td");c.textContent="To",a.appendChild(l),a.appendChild(o),a.appendChild(r),a.appendChild(s),a.appendChild(c),n.appendChild(a);for(let e=0;e<t.length;e++){const a=document.createElement("tr"),l=document.createElement("td");l.textContent=t[e].callsign;const o=document.createElement("td"),r=new Date(1e3*t[e].firstSeen).toString();o.textContent=r;const s=document.createElement("td"),c=new Date(1e3*t[e].lastSeen).toString();s.textContent=0===e?"TBD":c;const i=document.createElement("td");null===t[e].estDepartureAirport?i.textContent="N/A":i.textContent=t[e].estDepartureAirport;let d=document.createElement("td");null===t[e].estArrivalAirport?d.textContent="N/A":d.textContent=t[e].estArrivalAirport,a.appendChild(l),a.appendChild(o),a.appendChild(s),a.appendChild(i),a.appendChild(d),n.appendChild(a)}e.appendChild(n),b.appendChild(e),b.classList.add("table-style")}}()}();
//# sourceMappingURL=main.js.map